<!DOCTYPE html>
<html>
  <head>
    <title>Lobby</title>
  </head>

  <body>
    <ul id="players"></ul>
    <button id="join">Join Lobby</button>
    <button id="start" disabled>Start Game</button>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      let localUsername = null;

      const players = document.getElementById("players");
      const joinButton = document.getElementById("join");
      const startButton = document.getElementById("start");

      joinButton.addEventListener('click', () => {
        socket.emit('lobby.join');
      });

      startButton.addEventListener('click', () => {
        socket.emit('lobby.start_game');
      });

      socket.on('lobby.update.client_username', (username) => {
        localUsername = username;
      });

      socket.on('lobby.update.lobby_list', (lobby) => {
        const host = lobby[0];
        const isHost = host && localUsername === host;
        startButton.disabled = !isHost;

        players.replaceChildren(...lobby.map((username) => {
          const item = document.createElement('li');
          item.innerText = username;
          return item;
        }));
      });

      socket.on('redirect', (url) => {
        window.location.replace(url);
      });
    </script>
  </body>
</html>
